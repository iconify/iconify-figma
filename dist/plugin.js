!function(){"use strict";const e={compactWidth:!1,storageLimit:200,windowAction:"none",selectAfterImport:"auto",scrollToIcon:!0,customizeDrop:!1,dropToFrame:!0,stickyFooter:!1},t={version:2};async function n(){try{const t=await figma.clientStorage.getAsync("config");if("object"==typeof t&&"number"==typeof t.version)switch(t.version){case 1:return o(function(t){const n={version:2,options:Object.assign({},e),state:{customisations:{}}};if(t.options){const e=t.options,o=n.options;e.compactWidth&&(o.compactWidth=!0),void 0!==e.storageLimit&&(o.storageLimit=e.storageLimit);const i=n.state.customisations;["width","height","hFlip","vFlip","rotate","color"].forEach((t=>{const n=e[t];void 0!==n&&(i[t]=n)})),e.icon&&(n.state.icons=[e.icon])}return t.storage&&(n.iconsStorage=t.storage),n}(t));case 2:return o(t)}}catch(e){}return o(t)}function o(t){const n={version:2,options:Object.assign({},e),state:t.state?JSON.parse(JSON.stringify(t.state)):{}};for(const e in t){const o=t[e],i="storage"===e?"iconsStorage":e;switch(i){case"version":case"state":break;case"options":if(t.options){const e=t.options,o=n.options;for(const t in o){const n=t;void 0!==e[n]&&(o[n]=e[n])}}break;case"page":case"iconsStorage":case"recentColors":void 0!==o&&(n[i]=JSON.parse(JSON.stringify(o)))}}return n}const i={app:function(){const e=figma;try{const t=e.editorType;switch(t){case"figma":case"figjam":return t}}catch(e){}try{if("function"==typeof e.createSticky)return"figjam"}catch(e){}return"figma"}(),loaded:!1,config:o(t),minimized:!1};function c(e){switch(e.type){case"FRAME":case"COMPONENT":return!0}return!1}function r(e){if("iconify"===e.getSharedPluginData("iconify","source")){let t;try{t=JSON.parse(e.getSharedPluginData("iconify","props"))}catch(e){}if("object"==typeof t)switch(t.version){case 2:return t;case void 0:{const e=t;if("string"==typeof e.name)return{version:2,name:e.name,props:Object.assign({color:e.color},e.props)}}}return{version:2,name:e.name}}return null}function s(e,t){if(t&&c(e))return e;switch(e.type){case"GROUP":case"PAGE":return e}return null}const a={replace:"Replace icon",code:"Icon code for developers"},l={failed_icon:'Error importing icon "{name}"',failed_icons:"Error importing {count} icons",added_icon:'Imported icon "{name}"',added_icons:"Imported {count} icons",added_unnamed:"Imported icon",failed_unnamed:"Error importing icon",failed_replace:"Cannot find node to replace"};function d(e){figma.ui.postMessage(e)}function u(e,t){const n=figma.currentPage;let o=!1;switch(t){case"ignore":return;case"auto":n.selection.length>1&&(o=!0);break;case"add":o=!0}const i=o?n.selection.slice(0):[];n.selection=i.concat(e)}function f(e,t="frame",n){const o=figma.createNodeFromSvg(e);let i;if(n)i=n;else switch(t){case"component":i=figma.createComponent()}if(i){for(;i.children.length>0;)i.children[0].remove();i.resizeWithoutConstraints(o.width,o.height);for(const e of o.children)i.appendChild(e);return o.remove(),i}return o}function g(e,t,n,o){e.setSharedPluginData("iconify","source","iconify");const i={version:2,name:t,props:n,route:o};e.setSharedPluginData("iconify","props",JSON.stringify(i)),e.setRelaunchData(a)}function h(e,t){if(1===e.height){const n='viewBox="',o=t.indexOf(n);if(-1!==o){const i=t.slice(o+n.length).split('"').shift().split(" ");if(4===i.length){const t=parseInt(i[2]),n=parseInt(i[3]);t&&n&&e.resize(t,n)}}}}function p(e){if(!e.length)return;let t;if(e=e.toLowerCase(),i.config.recentColors){if(t=i.config.recentColors,t[0]===e)return;for(t=t.filter((t=>t!==e)),t.unshift(e);t.length>8;)t.pop()}else t=[e];i.config.recentColors=t,d({type:"update-recent-colors",colors:t})}function m(e,t,n){const o=[],r=[],a=[];let m,y=!1;function w(){var t,n;if(!m){let o=e.layerId;o&&!(null===(t=i.selection)||void 0===t?void 0:t.layers.find((e=>e.id===o)))&&(o=""),m=function(e){if(!e)return figma.currentPage;const t=figma.getNodeById(e);return(t?s(t,!0):null)||figma.currentPage}(e.layerId?e.layerId:null===(n=i.selection)||void 0===n?void 0:n.defaultLayer)}return m}t.forEach((t=>{let i,s=null;if(!t.replace||(s=figma.currentPage.findOne((e=>e.id===t.replace)),s&&c(s))){try{i=f(t.svg,e.mode,s)}catch(e){return r.push(t.name),void console.error("Error importing SVG",e)}void 0!==t.name?(g(i,t.name,e.props,n),i.name=t.name):h(i,t.svg),s||function(e,t){const n=e.width,o=e.height;if(function(e){try{switch(e.layoutMode){case"HORIZONTAL":case"VERTICAL":return!0}}catch(e){}return!1}(t))return void t.insertChild(0,e);const i=e.id,r=t.children.filter((e=>e.id!==i)),s=n=>{t.insertChild(0,e),e.x=n.x,e.y=n.y},a=(e,t,i,c)=>{if(null!==i&&e+n>i||null!==c&&t+o>c)return null;let s=e,a=t;for(;;){let t=!1;for(let l=0;l<r.length;l++){const d=r[l];if(!(d.x>s+n||d.y>a+o||d.x+d.width<=s||d.y+d.height<=a)&&(s=d.x+d.width,t=!0,null!==i&&s+n>i)){if(null!==c&&a+o>=c){const e=c-o;if(e<=a)return null;a=e}else a+=o;s=e;break}}if(!t)return{x:s,y:a}}};if(c(t)){const e=t,i=a(0,0,e.width,e.height);return i?void s(i):e.width<n||e.height<o?void s({x:0,y:0}):void s({x:Math.floor((e.width-n)/2),y:Math.floor((e.height-o)/2)})}switch(t.type){case"GROUP":{let e=a(t.x,t.y,t.x+t.width,t.y+t.height);if(!e){const n=e=>{const t=e.parent;if(!t)return null;if(c(t))return t;switch(t.type){case"GROUP":return n(t)}return null},o=n(t);o&&(e=a(t.x,t.y,o.width,o.height))}return e||(e=a(t.x,t.y,null,null)),e||(e={x:t.x,y:t.y}),void s(e)}case"PAGE":{const e=Math.round(figma.viewport.center.x-n/2),t=Math.round(figma.viewport.center.y-o/2);let i=a(e,t,null,null);return i||(i={x:e,y:t}),void s(i)}default:console.log("Unknown parent node type:",t.type),s({x:0,y:0})}}(i,w()),o.push(t.name),a.push(i)}else y=!0})),a.length&&u(a,i.config.options.selectAfterImport);const v=[],x=l;switch(o.length){case 0:break;case 1:{const e=o[0];v.push({layout:"success",message:void 0===e?x.added_unnamed:x.added_icon.replace("{name}",e)});break}default:v.push({layout:"success",message:x.added_icons.replace("{count}",o.length+"")})}switch(y&&v.push({layout:"error",message:x.failed_replace}),r.length){case 0:break;case 1:{const e=r[0];v.push({layout:"error",message:void 0===e?x.failed_unnamed:x.failed_icon.replace("{name}",e)});break}default:v.push({layout:"error",message:x.failed_icons.replace("{count}",r.length+"")})}return d({type:"notice",notice:v,importedIcons:o.filter((e=>"string"==typeof e))}),"string"==typeof e.props.color&&p(e.props.color),!y&&0===r.length}let y=null;function w(){y||(y=setTimeout(v,2e3))}async function v(){y&&(clearTimeout(y),y=null);const t=function(t){let n={version:2};for(const o in t){const i=o;switch(i){case"version":break;case"options":{const o=t.options,i={};let c=!1;for(const t in e){const n=t,r=o[n];r!==e[n]&&(i[n]=r,c=!0)}c&&(n.options=i);break}case"state":case"iconsStorage":case"recentColors":case"page":n[i]=t[i]}}return n}(i.config);try{await figma.clientStorage.setAsync("config",t)}catch(e){}}function x(){const e=figma.currentPage,t=e.selection,n={layer:{type:"PAGE",id:e.id,name:e.name},children:[]},o=Object.create(null),i=new Map;function a(e,t,l){const d="PAGE"===e.type?n:i.get(e.id);if(d)return void(l&&(d.children.push(l),d.children.sort(((e,t)=>e.layer.name.localeCompare(t.layer.name)))));const u=e.id;if(void 0!==o[u])return;const f=e;if(f.locked)return void(f.parent&&a(f.parent,t+1));const g=e.name;let h;const p=c(e)?e:null,m=p||s(e,!1);if(p){const e=r(p);if(e){if(0===t){const t={id:u,name:g,type:p.type,data:e};o[u]=t}l=void 0}else h={id:u,name:g.split("=").pop(),type:p.type,layoutMode:p.layoutMode&&"NONE"!==p.layoutMode?p.layoutMode:void 0}}else if(m)switch(m.type){case"GROUP":h={id:u,name:g,type:m.type}}else switch(e.type){case"COMPONENT_SET":case"INSTANCE":l=void 0}let y;h&&(y={layer:h,children:l?[l]:[]},i.set(u,y)),e.parent&&a(e.parent,t+1,y||l)}a(e,0),t.forEach((e=>{a(e,0)}));const l=[];let d=-1,u=!0;!function e(t,n){n<=d&&(u=!1),d=n;const o=t.layer;o.depth=n,l.push(o),t.children.forEach((t=>{e(t,n+1)}))}(n,0);const f=Object.keys(o);return{layers:l.length>1?l:[],defaultLayer:u&&l.length>1?l[l.length-1].id:"",icon:1===f.length?o[f[0]]:void 0}}let O=!1;function S(){O||(O=!0,setTimeout((()=>{O=!1;const e=x(),t=i.selection;t&&JSON.stringify(t)===JSON.stringify(e)||(i.selection=e,d({type:"target-layers",selection:e}))}),250))}const b={mini:{width:200,height:104},full:{width:690,min:460,max:720},compact:{width:514,min:400,max:600},innerDiff:90,outerDiff:150};function I(){if(i.minimized)return b.mini;const e=i.config.options.compactWidth,t=b[e?"compact":"full"];let n;if(i.windowInnerHeight){const e=i.windowOuterHeight?i.windowOuterHeight-b.outerDiff:i.windowInnerHeight-b.innerDiff;n=Math.max(Math.min(e,t.max),t.min)}else n=t.max;return console.log("Setting window height to:",n),{width:t.width,height:n}}function M(e,t,n){return!(t<e.x||n<e.y||t>e.x+e.width||n>e.y+e.height)}function P(e,t,n){for(let o=0;o<e.children.length;o++){const i=e.children[o];if(!i.locked&&i.visible)switch(i.type){case"GROUP":if(M(i,t,n)){const e=P(i,t,n);return e||{node:i,x:t,y:n}}break;case"FRAME":if(M(i,t,n)&&!r(i)){const e=P(i,t-i.x,n-i.y);return e||{node:i,x:t-i.x,y:n-i.y}}}}return null}function _(e,t){return P(figma.currentPage,e,t)}function k(e,t){const n=figma.viewport,o=n.zoom,c=n.bounds,r=c.width*o,s=c.height*o,a=t.window.width-r,m=t.window.height-s,y=a>=240,w=c.x-(a-(y?240:0))/o,v=c.y-m/o;let x=w+t.coords.x/o,O=v+t.coords.y/o;const S=l;let b;try{b=f(e.svg)}catch(t){return void d({type:"notice",notice:{layout:"error",message:void 0===e.name?S.failed_unnamed:S.failed_icon.replace("{name}",e.name)}})}const I=e.name;void 0!==I?(g(b,I,e.props),b.name=I):h(b,e.svg);let M=figma.currentPage;if(i.config.options.dropToFrame){const e=_(x,O);e&&(M=e.node,x=e.x,O=e.y)}M.appendChild(b),b.x=Math.round(x-b.width/2),b.y=Math.round(O-b.height/2),u([b],i.config.options.selectAfterImport);const P=void 0===I?[]:[I];d({type:"notice",notice:{layout:"success",message:void 0===I?S.added_unnamed:S.added_icon.replace("{name}",I)},importedIcons:P}),e.props&&"string"==typeof e.props.color&&p(e.props.color)}function C(){try{const e=new Set;return figma.getLocalPaintStyles().forEach((t=>{const n=t.paints;if(1!==n.length)return;const o=n[0];"SOLID"===o.type&&"NORMAL"===o.blendMode&&e.add(function(e){function t(e){const t=Math.min(Math.max(Math.round(255*e),0),255).toString(16);return 1===t.length?"0"+t:t}return"#"+t(e.r)+t(e.g)+t(e.b)}(o.color))})),Array.from(e)}catch(e){return[]}}async function E(){return v().then((()=>{figma.closePlugin()})).catch((e=>{}))}(async()=>{i.config=await n(),i.selection=x(),figma.on("selectionchange",S),figma.on("currentpagechange",S),figma.on("close",E),figma.showUI(__html__,Object.assign(Object.assign({},I()),{themeColors:!1})),figma.ui.onmessage=e=>{try{if("string"!=typeof e.type)return}catch(e){}const t=e;switch(t.type){case"ui-loaded":{i.windowInnerHeight=t.innerHeight,i.windowOuterHeight=t.outerHeight;const e=I();return figma.ui.resize(e.width,e.height),void d({type:"start-plugin",app:i.app,command:figma.command,selection:i.selection,iconsStorage:i.config.iconsStorage,recentColors:i.config.recentColors,options:i.config.options,state:i.config.state,colors:C()})}case"import-icon":if(m(t.data,t.icons,t.route)){switch(t.data.windowAction){case"minimize":i.minimized=!0;const e=I();figma.ui.resize(e.width,e.height),d({type:"toggle-minimize",minimized:!0});break;case"close":return void E()}S()}return;case"drop-icon":return void k(t.data,t.target);case"custom-icons":return i.config.iconsStorage||(i.config.iconsStorage={}),i.config.iconsStorage[t.storage]=t.icons,void w();case"close-plugin":return void E();case"minimize":{i.minimized=t.minimized;const e=I();return void figma.ui.resize(e.width,e.height)}case"update-options":{const e=i.config,n=e.options.compactWidth;if(e.options=t.options,n!==e.options.compactWidth){const e=I();figma.ui.resize(e.width,e.height)}return void w()}case"icon-finder-config":i.config.state.config=t.config,w();break;case"icon-finder-customisations":i.config.state.customisations=t.customisations,w();break;case"icon-finder-route":i.config.state.route=t.route,w();break;case"icon-finder-selection":i.config.state.icons=t.icons,w();break;default:console.log("Unhandled event from UI:",t)}}})()}();
